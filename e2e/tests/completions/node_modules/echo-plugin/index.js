// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.

// @ts-check
const createPlugin = require('../../../../_plugin');
const ts = require('../../../../node_modules/typescript/lib/tsserverlibrary');
const { decorateWithTemplateLanguageService } = require('../../../../../lib/index');

/**
 * @augments {TemplateStringLanguageService}
 */
class TestStringLanguageService {
    getCompletionsAtPosition({ text }, position) {
        let line = text.split(/\n/g)[position.line];
        return {
            isGlobalCompletion: false,
            isMemberCompletion: false,
            isNewIdentifierLocation: false,
            entries: [
                {
                    name: line.slice(0, position.character),
                    kind: 'kind',
                    kindModifiers: 'echo',
                    sortText: 'echo',
                    replacementSpan: { start: position.line, length: 1 },
                }
            ]
        };
    }
}

module.exports = createPlugin(
    (_log) => {
        return new TestStringLanguageService()
    }, {
        tags: ['test', 'starts:<'],
        enableForStringWithSubstitutions: true,
        getSubstitution(text, start, end) {
            return 'x'.repeat(end - start);
        }
    })
